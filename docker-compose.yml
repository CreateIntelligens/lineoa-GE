# Docker Compose 配置文件 - 用於定義和運行多容器 Docker 應用程式
# 此配置適用於 LINE Bot ADK 專案的開發和部署環境

services:
  # 定義主要的 LINE Bot 服務
  linebot-adk:
    # 從當前目錄的 Dockerfile 建置映像
    build: .
    user: "${HOST_UID:-1000}:${HOST_GID:-1000}"

    # 從 .env 文件載入環境變數
    env_file:
      - .env

    # 直接暴露 8000 port 給外部
    ports:
      - "8902:8902"

    # 數據卷掛載配置 - 用於開發時的即時更新
    volumes:
      # 掛載源代碼目錄，方便開發時即時更新程式碼
      - .:/app

    # 環境變數配置
    environment:
      # Python 環境配置
      - PYTHONPATH=/app:/app/src
      - PYTHONUNBUFFERED=1  # 確保 Python 輸出即時顯示，不使用緩衝

    # 開發模式命令：啟用自動重載，檔案變更時自動重啟服務
    command: uvicorn main:app --host=0.0.0.0 --port=8902 --reload

    # 容器重啟策略：除非手動停止，否則自動重啟
    restart: unless-stopped
